<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ArcGIS Maps SDK for JavaScript Tutorials: Display a map</title>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
 
  <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/css/main.css">
  <script src="https://js.arcgis.com/4.28/"></script>
   <script>
      require([
      "esri/Basemap",
      "esri/layers/TileLayer",
      "esri/layers/MapImageLayer",
      "esri/layers/ImageryTileLayer",
      "esri/layers/FeatureLayer",
      "esri/Map", 
      "esri/views/MapView",
      "esri/widgets/LayerList",
      //"esri/geometry/support/webMercatorUtils",
      "esri/widgets/CoordinateConversion",
       //"dojo/dom",
       //"dojo/domReady!"
    ],
       function( Basemap, TileLayer, MapImageLayer, ImageryTileLayer, FeatureLayer, Map, MapView, LayerList, CoordinateConversion) {
          PacWaveLayer1 = new FeatureLayer({
            url:"https://services1.arcgis.com/RW2IdRvIbmA3FJ1X/arcgis/rest/services/PacWavePlanningData/FeatureServer/4"
          });
          PacWaveLayer2 = new FeatureLayer({
            url:"https://services1.arcgis.com/RW2IdRvIbmA3FJ1X/arcgis/rest/services/PacWavePlanningData/FeatureServer/5"
          });
          Oropa_Contours = new FeatureLayer({
            url:"https://services1.arcgis.com/RW2IdRvIbmA3FJ1X/arcgis/rest/services/Contour_1m_Oropa/FeatureServer"
          });
          NOAAImageLayer = new MapImageLayer({
            portalItem: {
              id: "5cbd464c75a3444592f1dbd28d04af98"  //NOAA ENC
            //id: "1b243539f4514b6ba35e7d995890db1d" // World Hillshade
            }
          });
          HS_TileLayer = new TileLayer({
            url: "https://tiles.arcgis.com/tiles/RW2IdRvIbmA3FJ1X/arcgis/rest/services/HS_Bathy_Oropa/MapServer"
          })
          const imagePopupTemplate = {
          // autocasts as new PopupTemplate()
          title: "Oropa Bathymetry:",
          fieldInfos: [{
            fieldName: 'Raster.ServicePixelValue',
            format: {
                places:1
            }}],
            content: 'DEM Value:   {Raster.ServicePixelValue} Meters'
        };
        const params = {
            location: event.mapPoint
          };

          demImageLayer = new ImageryTileLayer ({
            url:"https://tiledimageservices1.arcgis.com/RW2IdRvIbmA3FJ1X/arcgis/rest/services/Bathy_Oropa_1m/ImageServer",
            popupEnabled: true,
            popupTemplate: imagePopupTemplate
          });
           const map = new Map({
            basemap: "oceans", // Basemap layer service
            layers: [NOAAImageLayer, demImageLayer, HS_TileLayer, Oropa_Contours, PacWaveLayer1,PacWaveLayer2]
          });
        
          const view = new MapView({
            map: map,
            center: [-124.2353, 44.5687], // Longitude, latitude
            zoom: 11, // Zoom level
            container: "viewDiv" // Div element
          });
          const ccWidget = new CoordinateConversion({
              view: view
            });
            view.ui.add(ccWidget, "bottom-left");
            const layerList = new LayerList({
              view: view
            });
             view.ui.add(layerList, {
              position: "top-right"
            });

         view.popupEnabled = false;
         view.on("click", (event) => {
          // Get the coordinates of the click on the view
          const lat = Math.round(event.mapPoint.latitude * 100000) / 100000;
          const lon = Math.round(event.mapPoint.longitude * 100000) / 100000;
          var point = view.toMap({x: lon, y: lat});
          bob = demImageLayer.identify(event.mapPoint)
           bob.then((response) => {
            console.log(response);
            const Cathy = Math.round(response.value * 10) / 10;
            view.openPopup({
            // Set the popup's title to the coordinates of the location
            title: "Lat, Lon, Depth(m): " + lat + ", " + lon + ", " + Cathy,
            location: event.mapPoint // Set the location of the popup to the clicked location
          });
          })
          .catch(() => {
            Cathy = "Alex";
          });

          const params = {
            location: event.mapPoint
          };       
         });
      });
    </script>
  
</head>

<body>
  <div id="viewDiv"></div>
 <!--- <span id="info" style="position:absolute; left:25px; bottom: 25px; color:#060606; z-index:50;"></span>->
</body>

</html>
