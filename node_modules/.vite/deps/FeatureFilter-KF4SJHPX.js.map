{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/layers/features/support/whereUtils.js", "../../@arcgis/core/views/2d/layers/features/support/FeatureFilter.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import r from\"../../../../../core/Logger.js\";import{parseWhereClause as t}from\"../../../../../core/sql.js\";const a=r.getLogger(\"esri.views.2d.layers.features.support.whereUtils\"),o={getAttribute:(e,r)=>e.readAttribute(r)};async function s(r,s){try{const n=await t(r,s);if(!n.isStandardized){const r=new e(\"mapview - bad input\",\"Unable to apply filter's definition expression, as expression is not standardized.\",n);a.error(r)}return e=>{const r=e.readArcadeFeature();return n.testFeature(r,o)}}catch(n){return a.warn(\"mapview-bad-where-clause\",\"Encountered an error when evaluating where clause\",r),e=>!0}}export{s as createWhereClause};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import e from\"../../../../../core/Logger.js\";import{create as i}from\"../../../../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as s}from\"../../../../../geometry/support/boundsUtils.js\";import{normalizeQueryLike as r}from\"../../../../../layers/graphics/data/queryUtils.js\";import{getSpatialQueryOperator as o}from\"../../../../../layers/graphics/data/spatialQuerySupport.js\";import{getTimeOperator as h}from\"../../../../../layers/graphics/data/timeSupport.js\";import a from\"../../../../../rest/support/Query.js\";import{featureAdapter as l}from\"../FeatureStore2D.js\";import{createWhereClause as n}from\"./whereUtils.js\";const d=1,m=2;class p{constructor(t){this._geometryBounds=i(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,d)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(this._idToVisibility.get(r)&d),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?d|m:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return a.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await r(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t?.where)return this._clause=null,void(this.where=null);this._clause=await n(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t?.objectIds&&new Set(t.objectIds),this._idsToHide=t?.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t?.objectIds}async _setGeometryFilter(t){if(!t?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",r=await o(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);s(this._geometryBounds,e),this._spatialQueryOperator=r,this.geometry=e,this.spatialRel=i}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=i.timeExtent,this._timeOperator=h(this._serviceInfo.timeInfo,i.timeExtent,l);else{const s=new t(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",i.timeExtent);e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\").error(s)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide?.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return null==this._timeOperator||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{e&d||(this._idToVisibility.set(i,d),t.push(i))})),t}}export{p as default};\n"],
  "mappings": "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",
  "names": ["a", "e", "s", "r", "t", "e", "s", "o"]
}
