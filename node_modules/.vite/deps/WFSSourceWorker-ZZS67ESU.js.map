{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/graphics/sources/WFSSourceWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{throwIfAborted as s,isAbortError as a}from\"../../../core/promiseUtils.js\";import{equals as i}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as o,convertToGeometry as n}from\"../featureConversionUtils.js\";import u from\"../data/FeatureStore.js\";import{checkProjectionSupport as p,project as l}from\"../data/projectionSupport.js\";import{QueryEngine as h}from\"../data/QueryEngine.js\";import{validateGeoJSON as c,createOptimizedFeatures as m}from\"./geojson/geojson.js\";import{mixAttributes as y}from\"./support/sourceUtils.js\";import{getGetFeatureSpatialReference as f,getFeature as g}from\"../../ogc/wfsUtils.js\";import d from\"../../support/FieldsIndex.js\";import{utc as _}from\"../../../time/timeZoneUtils.js\";class F{constructor(){this._queryEngine=null,this._customParameters=null}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r){const{getFeatureUrl:a,getFeatureOutputFormat:i,fields:o,geometryType:n,featureType:l,objectIdField:c,customParameters:m}=e,{spatialReference:y,getFeatureSpatialReference:g}=f(a,l,e.spatialReference);this._featureType=l,this._customParameters=m,this._getFeatureUrl=a,this._getFeatureOutputFormat=i,this._getFeatureSpatialReference=g;try{await p(g,y)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{inSpatialReference:g,outSpatialReference:y})}s(r);const F=d.fromLayerJSON({fields:o,dateFieldsTimeReference:o.some((e=>\"esriFieldTypeDate\"===e.type))?{timeZoneIANA:_}:null}),w=await this._snapshotFeatures({fieldsIndex:F,geometryType:n,objectIdField:c,spatialReference:y},r.signal);return this._queryEngine=new h({fieldsIndex:F,geometryType:n,hasM:!1,hasZ:!1,objectIdField:c,spatialReference:y,timeInfo:null,featureStore:new u({geometryType:n,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(w),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(s){return this._customParameters=s,this._snapshotTask?.abort(),this._snapshotTask=e((e=>this._snapshotFeatures(this._queryEngine,e))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),a(e)||r.getLogger(\"esri.layers.WFSLayer\").error(new t(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:e}))})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures({objectIdField:e,geometryType:t,spatialReference:r,fieldsIndex:a},u){const p=await g(this._getFeatureUrl??\"\",this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:u});c(p,this._getFeatureSpatialReference.wkid),s(u);const h=m(p,{geometryType:t,hasZ:!1,objectIdField:e});if(!i(r,this._getFeatureSpatialReference))for(const s of h)null!=s.geometry&&(s.geometry=o(l(n(s.geometry,t,!1,!1),this._getFeatureSpatialReference,r)));let f=1;for(const s of h){const t={};y(a,t,s.attributes,!0),s.attributes=t,null==t[e]&&(s.objectId=t[e]=f++)}return h}}export{F as default};\n"],
  "mappings": "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",
  "names": ["i", "m", "s", "F", "e", "p", "d", "t"]
}
