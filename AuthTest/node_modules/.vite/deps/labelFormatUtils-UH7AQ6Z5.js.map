{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/support/labelFormatUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import r from\"../../core/Logger.js\";import{parseWhereClause as t}from\"../../core/sql.js\";import{formatDate as n,convertDateFormatToIntlOptions as o}from\"../../intl/date.js\";import{formatNumber as a}from\"../../intl/number.js\";import{getDomainRange as l}from\"./domainUtils.js\";import{isDateField as i,isNumericField as s}from\"./fieldUtils.js\";import{getLabelExpression as u,getSingleFieldArcadeExpression as c}from\"./labelUtils.js\";import{createLabelExpression as f}from\"../../support/arcadeOnDemand.js\";const m=r.getLogger(\"esri.layers.support.labelFormatUtils\"),p={type:\"simple\",evaluate:()=>null},d={getAttribute:(e,r)=>e.field(r)};async function w(r,n,o){if(!r||!r.symbol||!n)return p;const a=r.where,l=u(r);let i;if(\"arcade\"===l.type){const r=await f(l.expression,o,n);if(null==r)return p;i={type:\"arcade\",evaluate(t,n){try{const e=\"attributes\"in t?r.repurposeFeature(t):t;e.contextTimeZone=n??null;const o=r.evaluate({$view:{timeZone:n},$feature:e},r.services);if(null!=o)return o.toString()}catch(o){m.error(new e(\"arcade-expression-error\",\"Encountered an error when evaluating label expression for feature\",{error:o,feature:t,expression:l}))}return null},needsHydrationToEvaluate:()=>null==c(l.expression)}}else i={type:\"simple\",evaluate:e=>l.expression.replaceAll(/{[^}]*}/g,(r=>{const t=r.slice(1,-1),o=n.get(t);if(!o)return r;let a=null;if(\"attributes\"in e){e&&e.attributes&&(a=e.attributes[o.name])}else a=e.field(o.name);return null==a?\"\":g(a,o)}))};if(a){let r;try{r=await t(a,n)}catch(s){return m.error(new e(\"bad-where-clause\",\"Encountered an error when evaluating where clause, ignoring\",{where:a,error:s})),p}const o=i.evaluate;i.evaluate=(t,n)=>{const l=\"attributes\"in t?void 0:d;try{if(r.testFeature(t,l))return o(t,n)}catch(s){m.error(new e(\"bad-where-clause\",\"Encountered an error when evaluating where clause for feature\",{where:a,feature:t,error:s}))}return null}}return i}function g(e,r){if(null==e)return\"\";const t=r.domain;if(t)if(\"codedValue\"===t.type||\"coded-value\"===t.type){const r=e;for(const e of t.codedValues)if(e.code===r)return e.name}else if(\"range\"===t.type){const{max:n,min:o}=l(r),a=+e;if(null!=o&&null!=n&&o<=a&&a<=n)return t.name}let u=e;return i(r)?u=n(u,o(\"short-date\")):s(r)&&(u=a(+u)),u||\"\"}export{w as createLabelFunction,g as formatField};\n"],
  "mappings": "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",
  "names": ["d", "e", "r", "n", "o", "s", "a", "l", "u"]
}
