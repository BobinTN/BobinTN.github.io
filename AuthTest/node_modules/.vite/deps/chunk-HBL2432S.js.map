{
  "version": 3,
  "sources": ["../../@arcgis/core/versionManagement/support/versionManagementUtils.js", "../../@arcgis/core/layers/mixins/EditBusLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{generateLowercaseBracedUUID as e}from\"../../core/uuid.js\";const r=e(),t=new Map,n=new Map,o=new Map;async function s(e,t,o=!1){if(!e||!t)return!0;const s=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),a=n.get(s)?.entries();if(a)for(const[n,i]of a)if(i.name===t){const e=!i.stack?.hasForwardEdits();if(!e&&o){const[{deleteForwardEdits:e},{default:t}]=await Promise.all([import(\"../../rest/versionManagement/gdbVersion/deleteForwardEdits.js\"),import(\"../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters.js\")]);return e(s,n,new t({sessionId:r,moment:i.moment}))}return e}return!0}function a(e,r){if(!e)return!1;const t=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),o=n.get(t)?.entries();if(o)for(const[n,s]of o)if(s.name===r){return\"edit\"===s.lockType}return!1}export{r as currentSessionId,t as defaultVersionNameLookup,s as isSafeToEditVersion,a as isVersionInEditSession,n as versionCollection,o as versionCollectionCount};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Evented.js\";import{clone as s}from\"../../core/lang.js\";import{createResolver as i}from\"../../core/promiseUtils.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Error.js\";import\"../../core/has.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import{defaultVersionNameLookup as d,isVersionInEditSession as n}from\"../../versionManagement/support/versionManagementUtils.js\";const o=new t.EventEmitter;function l(e){return o.on(\"apply-edits\",new WeakRef(e))}function a(e){return o.on(\"update-moment\",new WeakRef(e))}function c(e,t,s=null,r=!1){const d=i();return r=null==t||r,o.emit(\"apply-edits\",{serviceUrl:e,layerId:t,gdbVersion:s,mayReceiveServiceEdits:r,result:d.promise}),d}function h(e,t,s=null,i){o.emit(\"update-moment\",{serviceUrl:e,layerId:t,gdbVersion:s,moment:i})}const u=\"esri.layers.mixins.EditBusLayer\",m=Symbol(u);function p(e){return null!=e&&\"object\"==typeof e&&m in e}function b(e){return null!=e&&\"object\"==typeof e&&\"gdbVersion\"in e}function g(e,t,s){const i=new URL(e).host,r=d.get(i),n=e=>!e||e===r;return n(t)&&n(s)||t===s}const F=t=>{var i;let d=class extends t{constructor(...e){super(...e),this[i]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:i,gdbVersion:r,mayReceiveServiceEdits:d,result:o}=e,l=t===this.url,a=null!=i&&null!=this.layerId&&i===this.layerId,c=b(this),h=b(this)&&g(t,r,this.gdbVersion);if(!l||c&&!h||!a&&!d)return;const u=o.then((e=>{if(a&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit(\"edits\",s(e)),e;const t=e.editedFeatures?.find((({layerId:e})=>e===this.layerId));if(t){const{adds:i,updates:r,deletes:d}=t.editedFeatures,n={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:i?i.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],deletedFeatures:d?d.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],updatedFeatures:r?r.map((({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],editedFeatures:s(e.editedFeatures),exceededTransferLimit:!1,historicMoment:s(e.historicMoment)};return this.emit(\"edits\",n),n}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:s(e.editedFeatures),exceededTransferLimit:!1,historicMoment:s(e.historicMoment)}})).then((e=>(\"historicMoment\"in this&&this.historicMoment!==e.historicMoment&&n(t,r)&&(this.historicMoment=e.historicMoment),e)));this.emit(\"apply-edits\",{result:u})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:s,moment:i}=e,r=t===this.url,d=b(this),n=b(this)&&g(t,s,this.gdbVersion),o=b(this)&&!g(t,this.gdbVersion,null);r&&d&&n&&o&&\"historicMoment\"in this&&this.historicMoment!==i&&(this.historicMoment=i)},this.when().then((()=>{this.addHandles(l(this._applyEditsHandler)),\"historicMoment\"in this&&this.addHandles(a(this._updateMomentHandler))}),(()=>{}))}};return i=m,d=e([r(u)],d),d};export{F as EditBusLayer,c as emitApplyEditsEvent,h as emitUpdateMomentEvent,p as isEditBusLayer,b as isLayerWithGDBVersion,l as onApplyEditsEvent,a as onUpdateMomentEvent,g as versionMatches};\n"],
  "mappings": "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",
  "names": ["o", "e", "t", "o", "s", "a", "n", "r", "o", "e", "a", "c", "t", "s", "r", "e", "t", "s", "r", "n", "i", "d", "o", "l", "a", "c", "u"]
}
