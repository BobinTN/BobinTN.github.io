{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/save/utils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{updateOrigins as t}from\"../../core/accessorSupport/originUtils.js\";import r from\"../../portal/Portal.js\";import o from\"../../portal/PortalItem.js\";import{createForItemWrite as a}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as i,TypeKeyword as n}from\"../../portal/support/portalItemUtils.js\";import{validateSaveAPIKey as s}from\"../../webdoc/saveAPIKeyUtils.js\";function l(t,r,o){const a=o(t);if(!a.isValid)throw new e(`${r}:invalid-parameters`,a.errorMessage,{layer:t})}async function p(e){const{layer:t,errorNamePrefix:r,validateLayer:o}=e;await t.load(),l(t,r,o)}function m(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function c(t){const{item:r,itemType:o,errorNamePrefix:a,layer:i,validateItem:n}=t;if(s(r),r.type!==o)throw new e(`${a}:portal-item-wrong-type`,`Portal item type should be \"${o}\"`,{item:r,layer:i});if(n){const t=n(r);if(!t.isValid)throw new e(`${a}:invalid-parameters`,t.errorMessage,{layer:i})}}function d(t){const{layer:r,errorNamePrefix:o}=t,{portalItem:a}=r;if(!a)throw new e(`${o}:portal-item-not-set`,m(r,\"requires the portalItem property to be set\"));if(!a.loaded)throw new e(`${o}:portal-item-not-loaded`,m(r,\"cannot be saved to a portal item that does not exist or is inaccessible\"));c({...t,item:a})}function u(e){const{newItem:t,itemType:a}=e;let i=o.from(t);return i.id&&(i=i.clone(),i.id=null),i.type??=a,i.portal??=r.getDefault(),c({...e,item:i}),i}function f(t,r){let o=(t.messages??[]).filter((({type:e})=>\"error\"===e)).map((({name:t,message:r,details:o})=>new e(t,r,o)));if(t.blockedRelativeUrls&&(o=o.concat(t.blockedRelativeUrls.map((t=>new e(\"url:unsupported\",`Relative url '${t}' is not supported`))))),r?.ignoreUnsupported&&(o=o.filter((({name:e})=>\"layer:unsupported\"!==e&&\"symbol:unsupported\"!==e&&\"symbol-layer:unsupported\"!==e&&\"property:unsupported\"!==e&&\"url:unsupported\"!==e))),o.length>0)throw new e(\"layer-write:unsupported\",\"Failed to save layer due to unsupported or invalid content. See 'details.errors' for more detailed information\",{errors:o})}async function y(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const o=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),f(t,r),o}function w(e){i(e,n.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function v(e,t,r){const o=e.portal;await o.signIn(),await(o.user?.addItem({item:e,data:t,folder:r?.folder}))}async function I(e,r){const{layer:o,createItemData:i,createJSONContext:n,saveResources:s}=e;await p(e),d(e);const l=o.portalItem,m=n?n(l):a(l),c=await y(o,m,r),u=await i({layer:o,layerJSON:c},l);return w(l),await l.update({data:u}),t(m),await(s?.(l,m)),l}async function b(e,r){const{layer:o,createItemData:i,createJSONContext:n,setItemProperties:s,saveResources:l}=e;await p(e);const m=u(e),c=n?n(m):a(m),d=await y(o,c,r),f=await i({layer:o,layerJSON:d},m);return await s(o,m),w(m),await v(m,f,r),o.portalItem=m,t(c),await(l?.(m,c)),m}export{v as addItem,m as createErrorMessage,d as ensureItemConfig,l as ensureLayerConfig,y as getLayerJSON,u as getPortalItem,I as save,b as saveAs,w as setCommonItemProperties};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAIqa,SAAS,EAAE,GAAE,GAAEA,IAAE;AAAC,QAAM,IAAEA,GAAE,CAAC;AAAE,MAAG,CAAC,EAAE;AAAQ,UAAM,IAAI,EAAE,GAAG,CAAC,uBAAsB,EAAE,cAAa,EAAC,OAAM,EAAC,CAAC;AAAC;AAAC,eAAe,EAAE,GAAE;AAAC,QAAK,EAAC,OAAM,GAAE,iBAAgB,GAAE,eAAcA,GAAC,IAAE;AAAE,QAAM,EAAE,KAAK,GAAE,EAAE,GAAE,GAAEA,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE,GAAE;AAAC,SAAM,iBAAiB,EAAE,KAAK,SAAS,EAAE,EAAE,cAAc,EAAE,aAAa,KAAK,CAAC;AAAE;AAAC,SAAS,EAAE,GAAE;AAAC,QAAK,EAAC,MAAK,GAAE,UAASA,IAAE,iBAAgB,GAAE,OAAMC,IAAE,cAAa,EAAC,IAAE;AAAE,MAAGA,GAAE,CAAC,GAAE,EAAE,SAAOD;AAAE,UAAM,IAAI,EAAE,GAAG,CAAC,2BAA0B,+BAA+BA,EAAC,KAAI,EAAC,MAAK,GAAE,OAAMC,GAAC,CAAC;AAAE,MAAG,GAAE;AAAC,UAAMC,KAAE,EAAE,CAAC;AAAE,QAAG,CAACA,GAAE;AAAQ,YAAM,IAAI,EAAE,GAAG,CAAC,uBAAsBA,GAAE,cAAa,EAAC,OAAMD,GAAC,CAAC;AAAA,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE;AAAC,QAAK,EAAC,OAAM,GAAE,iBAAgBD,GAAC,IAAE,GAAE,EAAC,YAAW,EAAC,IAAE;AAAE,MAAG,CAAC;AAAE,UAAM,IAAI,EAAE,GAAGA,EAAC,wBAAuB,EAAE,GAAE,4CAA4C,CAAC;AAAE,MAAG,CAAC,EAAE;AAAO,UAAM,IAAI,EAAE,GAAGA,EAAC,2BAA0B,EAAE,GAAE,yEAAyE,CAAC;AAAE,IAAE,EAAC,GAAG,GAAE,MAAK,EAAC,CAAC;AAAC;AAAC,SAAS,EAAE,GAAE;AAAC,QAAK,EAAC,SAAQ,GAAE,UAAS,EAAC,IAAE;AAAE,MAAIC,KAAE,EAAE,KAAK,CAAC;AAAE,SAAOA,GAAE,OAAKA,KAAEA,GAAE,MAAM,GAAEA,GAAE,KAAG,OAAMA,GAAE,SAAFA,GAAE,OAAO,IAAEA,GAAE,WAAFA,GAAE,SAAS,EAAE,WAAW,IAAE,EAAE,EAAC,GAAG,GAAE,MAAKA,GAAC,CAAC,GAAEA;AAAC;AAAC,SAASE,GAAE,GAAE,GAAE;AAAC,MAAIH,MAAG,EAAE,YAAU,CAAC,GAAG,OAAQ,CAAC,EAAC,MAAK,EAAC,MAAI,YAAU,CAAE,EAAE,IAAK,CAAC,EAAC,MAAKE,IAAE,SAAQE,IAAE,SAAQJ,GAAC,MAAI,IAAI,EAAEE,IAAEE,IAAEJ,EAAC,CAAE;AAAE,MAAG,EAAE,wBAAsBA,KAAEA,GAAE,OAAO,EAAE,oBAAoB,IAAK,CAAAE,OAAG,IAAI,EAAE,mBAAkB,iBAAiBA,EAAC,oBAAoB,CAAE,CAAC,KAAG,uBAAG,uBAAoBF,KAAEA,GAAE,OAAQ,CAAC,EAAC,MAAK,EAAC,MAAI,wBAAsB,KAAG,yBAAuB,KAAG,+BAA6B,KAAG,2BAAyB,KAAG,sBAAoB,CAAE,IAAGA,GAAE,SAAO;AAAE,UAAM,IAAI,EAAE,2BAA0B,kHAAiH,EAAC,QAAOA,GAAC,CAAC;AAAC;AAAC,eAAe,EAAE,GAAE,GAAE,GAAE;AAJ7kE;AAI8kE,kBAAe,KAAG,cAAY,OAAO,EAAE,cAAY,MAAM,EAAE,WAAW;AAAE,QAAMA,KAAE,EAAE,MAAM,CAAC,GAAE,CAAC;AAAE,SAAO,MAAM,QAAQ,MAAI,OAAE,cAAF,mBAAa,sBAAmB,CAAC,CAAC,GAAEG,GAAE,GAAE,CAAC,GAAEH;AAAC;AAAC,SAAS,EAAE,GAAE;AAAC,IAAE,GAAE,EAAE,KAAK,GAAE,EAAE,iBAAe,EAAE,eAAa,EAAE,aAAa,OAAQ,CAACK,IAAE,GAAE,MAAI,EAAE,QAAQA,EAAC,MAAI,CAAE;AAAE;AAAC,eAAe,EAAE,GAAE,GAAE,GAAE;AAJx3E;AAIy3E,QAAML,KAAE,EAAE;AAAO,QAAMA,GAAE,OAAO,GAAE,QAAM,KAAAA,GAAE,SAAF,mBAAQ,QAAQ,EAAC,MAAK,GAAE,MAAK,GAAE,QAAO,uBAAG,OAAM;AAAG;AAAC,eAAe,EAAE,GAAE,GAAE;AAAC,QAAK,EAAC,OAAMA,IAAE,gBAAeC,IAAE,mBAAkB,GAAE,eAAcK,GAAC,IAAE;AAAE,QAAM,EAAE,CAAC,GAAE,EAAE,CAAC;AAAE,QAAMC,KAAEP,GAAE,YAAWQ,KAAE,IAAE,EAAED,EAAC,IAAE,EAAEA,EAAC,GAAEE,KAAE,MAAM,EAAET,IAAEQ,IAAE,CAAC,GAAEE,KAAE,MAAMT,GAAE,EAAC,OAAMD,IAAE,WAAUS,GAAC,GAAEF,EAAC;AAAE,SAAO,EAAEA,EAAC,GAAE,MAAMA,GAAE,OAAO,EAAC,MAAKG,GAAC,CAAC,GAAET,GAAEO,EAAC,GAAE,OAAMF,MAAA,gBAAAA,GAAIC,IAAEC,MAAID;AAAC;AAAC,eAAe,EAAE,GAAE,GAAE;AAAC,QAAK,EAAC,OAAMP,IAAE,gBAAeC,IAAE,mBAAkB,GAAE,mBAAkBK,IAAE,eAAcC,GAAC,IAAE;AAAE,QAAM,EAAE,CAAC;AAAE,QAAMC,KAAE,EAAE,CAAC,GAAEC,KAAE,IAAE,EAAED,EAAC,IAAE,EAAEA,EAAC,GAAEG,KAAE,MAAM,EAAEX,IAAES,IAAE,CAAC,GAAEN,KAAE,MAAMF,GAAE,EAAC,OAAMD,IAAE,WAAUW,GAAC,GAAEH,EAAC;AAAE,SAAO,MAAMF,GAAEN,IAAEQ,EAAC,GAAE,EAAEA,EAAC,GAAE,MAAM,EAAEA,IAAEL,IAAE,CAAC,GAAEH,GAAE,aAAWQ,IAAEP,GAAEQ,EAAC,GAAE,OAAMF,MAAA,gBAAAA,GAAIC,IAAEC,MAAID;AAAC;",
  "names": ["o", "i", "t", "f", "r", "e", "s", "l", "m", "c", "u", "d"]
}
