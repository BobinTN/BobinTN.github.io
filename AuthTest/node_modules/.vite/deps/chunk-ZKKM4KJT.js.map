{
  "version": 3,
  "sources": ["../../@arcgis/core/webdoc/support/saveUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{result as e}from\"../../core/asyncUtils.js\";import r from\"../../core/Error.js\";import{allSettledErrors as o,throwIfAborted as t,eachAlways as s}from\"../../core/promiseUtils.js\";import{generateUUID as a}from\"../../core/uuid.js\";import{getSiblingOfSameTypeI as c,contentToBlob as n}from\"../../portal/support/resourceUtils.js\";async function u(e,r,o=null){const t=await i(e,r,o);await h(t,r,o)}async function p(e,r,o,t,s=null){const a=await i(o,t,s);await e.update({data:r}),await h(a,t,s)}async function i(e,s,n=null){if(!s?.resources)return;const u=s.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=s.portalItem;const p=new Set(s.resources.toKeep.map((e=>e.resource.path))),i=new Set,h=[];p.forEach((r=>{u.delete(r),e.paths.push(r)}));for(const r of s.resources.toUpdate)if(u.delete(r.resource.path),p.has(r.resource.path)||i.has(r.resource.path)){const{resource:o,content:t,finish:s,error:u}=r,p=c(o,a());e.paths.push(p.path),h.push(f({resource:p,content:t,compress:r.compress,finish:s,error:u},n))}else e.paths.push(r.resource.path),h.push(l(r,n)),i.add(r.resource.path);for(const r of s.resources.toAdd)e.paths.push(r.resource.path),u.has(r.resource.path)?u.delete(r.resource.path):h.push(f(r,n));if(0===h.length)return u;const m=await o(h);if(t(n),m.length>0)throw new r(\"save:resources\",\"Failed to save one or more resources\",{errors:m});return u}async function h(e,r,o=null){if(!e||!r.portalItem)return;const t=[];for(const s of e){const e=r.portalItem.resourceFromPath(s);t.push(e.portalItem.removeResource(e,o))}await s(t)}async function f(r,o){const t={...null!=o?o:{},compress:r.compress},s=await e(r.resource.portalItem.addResource(r.resource,await n(r.content),t));if(!0!==s.ok)throw r.error?.(s.error),s.error;r.finish?.(r.resource)}async function l(r,o){const t=await e(r.resource.update(await n(r.content),o));if(!0!==t.ok)throw r.error?.(t.error),t.error;r.finish?.(r.resource)}async function m(e){const r=[];for(const o of e.allLayers)if(\"beforeSave\"in o&&\"function\"==typeof o.beforeSave){const e=o.beforeSave();e&&r.push(e)}await Promise.allSettled(r)}export{m as beforeSave,u as saveResources,p as updateItemWithResources};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAI0U,eAAe,EAAE,GAAE,GAAE,IAAE,MAAK;AAAC,QAAM,IAAE,MAAM,EAAE,GAAE,GAAE,CAAC;AAAE,QAAM,EAAE,GAAE,GAAE,CAAC;AAAC;AAAC,eAAeA,GAAE,GAAE,GAAE,GAAE,GAAEC,KAAE,MAAK;AAAC,QAAM,IAAE,MAAM,EAAE,GAAE,GAAEA,EAAC;AAAE,QAAM,EAAE,OAAO,EAAC,MAAK,EAAC,CAAC,GAAE,MAAM,EAAE,GAAE,GAAEA,EAAC;AAAC;AAAC,eAAe,EAAE,GAAEA,IAAEC,KAAE,MAAK;AAAC,MAAG,EAACD,MAAA,gBAAAA,GAAG;AAAU;AAAO,QAAME,KAAEF,GAAE,eAAa,EAAE,aAAW,IAAI,IAAI,EAAE,KAAK,IAAE,oBAAI;AAAI,IAAE,MAAM,SAAO,GAAE,EAAE,aAAWA,GAAE;AAAW,QAAMD,KAAE,IAAI,IAAIC,GAAE,UAAU,OAAO,IAAK,CAAAG,OAAGA,GAAE,SAAS,IAAK,CAAC,GAAEC,KAAE,oBAAI,OAAIC,KAAE,CAAC;AAAE,EAAAN,GAAE,QAAS,OAAG;AAAC,IAAAG,GAAE,OAAO,CAAC,GAAE,EAAE,MAAM,KAAK,CAAC;AAAA,EAAC,CAAE;AAAE,aAAU,KAAKF,GAAE,UAAU;AAAS,QAAGE,GAAE,OAAO,EAAE,SAAS,IAAI,GAAEH,GAAE,IAAI,EAAE,SAAS,IAAI,KAAGK,GAAE,IAAI,EAAE,SAAS,IAAI,GAAE;AAAC,YAAK,EAAC,UAAS,GAAE,SAAQ,GAAE,QAAOJ,IAAE,OAAME,GAAC,IAAE,GAAEH,KAAE,EAAE,GAAE,EAAE,CAAC;AAAE,QAAE,MAAM,KAAKA,GAAE,IAAI,GAAEM,GAAE,KAAK,EAAE,EAAC,UAASN,IAAE,SAAQ,GAAE,UAAS,EAAE,UAAS,QAAOC,IAAE,OAAME,GAAC,GAAED,EAAC,CAAC;AAAA,IAAC;AAAM,QAAE,MAAM,KAAK,EAAE,SAAS,IAAI,GAAEI,GAAE,KAAK,EAAE,GAAEJ,EAAC,CAAC,GAAEG,GAAE,IAAI,EAAE,SAAS,IAAI;AAAE,aAAU,KAAKJ,GAAE,UAAU;AAAM,MAAE,MAAM,KAAK,EAAE,SAAS,IAAI,GAAEE,GAAE,IAAI,EAAE,SAAS,IAAI,IAAEA,GAAE,OAAO,EAAE,SAAS,IAAI,IAAEG,GAAE,KAAK,EAAE,GAAEJ,EAAC,CAAC;AAAE,MAAG,MAAII,GAAE;AAAO,WAAOH;AAAE,QAAMI,KAAE,MAAM,EAAED,EAAC;AAAE,MAAGL,GAAEC,EAAC,GAAEK,GAAE,SAAO;AAAE,UAAM,IAAI,EAAE,kBAAiB,wCAAuC,EAAC,QAAOA,GAAC,CAAC;AAAE,SAAOJ;AAAC;AAAC,eAAe,EAAE,GAAE,GAAE,IAAE,MAAK;AAAC,MAAG,CAAC,KAAG,CAAC,EAAE;AAAW;AAAO,QAAM,IAAE,CAAC;AAAE,aAAUF,MAAK,GAAE;AAAC,UAAMG,KAAE,EAAE,WAAW,iBAAiBH,EAAC;AAAE,MAAE,KAAKG,GAAE,WAAW,eAAeA,IAAE,CAAC,CAAC;AAAA,EAAC;AAAC,QAAM,EAAE,CAAC;AAAC;AAAC,eAAe,EAAE,GAAE,GAAE;AAJtjD;AAIujD,QAAM,IAAE,EAAC,GAAG,QAAM,IAAE,IAAE,CAAC,GAAE,UAAS,EAAE,SAAQ,GAAEH,KAAE,MAAM,EAAE,EAAE,SAAS,WAAW,YAAY,EAAE,UAAS,MAAM,EAAE,EAAE,OAAO,GAAE,CAAC,CAAC;AAAE,MAAG,SAAKA,GAAE;AAAG,WAAM,OAAE,UAAF,2BAAUA,GAAE,QAAOA,GAAE;AAAM,UAAE,WAAF,2BAAW,EAAE;AAAS;AAAC,eAAe,EAAE,GAAE,GAAE;AAJ7wD;AAI8wD,QAAM,IAAE,MAAM,EAAE,EAAE,SAAS,OAAO,MAAM,EAAE,EAAE,OAAO,GAAE,CAAC,CAAC;AAAE,MAAG,SAAK,EAAE;AAAG,WAAM,OAAE,UAAF,2BAAU,EAAE,QAAO,EAAE;AAAM,UAAE,WAAF,2BAAW,EAAE;AAAS;AAAC,eAAeM,GAAE,GAAE;AAAC,QAAM,IAAE,CAAC;AAAE,aAAU,KAAK,EAAE;AAAU,QAAG,gBAAe,KAAG,cAAY,OAAO,EAAE,YAAW;AAAC,YAAMH,KAAE,EAAE,WAAW;AAAE,MAAAA,MAAG,EAAE,KAAKA,EAAC;AAAA,IAAC;AAAC,QAAM,QAAQ,WAAW,CAAC;AAAC;",
  "names": ["p", "s", "n", "u", "e", "i", "h", "m"]
}
