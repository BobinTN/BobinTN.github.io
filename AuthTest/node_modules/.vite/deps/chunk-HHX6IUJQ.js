import {
  _
} from "./chunk-2FFBPEOX.js";
import {
  m
} from "./chunk-NDKHIQMD.js";
import {
  g,
  y2 as y
} from "./chunk-LXXF7K7W.js";
import {
  c
} from "./chunk-SBW6NNVI.js";
import {
  e
} from "./chunk-62CXLI6S.js";
import {
  u
} from "./chunk-WGO3VFQP.js";

// node_modules/@arcgis/core/views/2d/tiling/TileQueue.js
function c2(e2, t) {
  return e2.length = 0, t.forEach((t2) => e2.push(t2)), e2;
}
var u2 = /* @__PURE__ */ new Set();
var a = [];
var h = /* @__PURE__ */ new Map();
var l = [0, 0];
var p = class extends g {
  constructor(e2) {
    super(e2), this._keyToItem = /* @__PURE__ */ new Map(), this.concurrency = 6, this.strategy = "scale-first", this.tileInfoView = null;
  }
  initialize() {
    const { concurrency: e2, process: t, strategy: s } = this;
    this._queue = new _({ concurrency: e2, process: (e3, s2) => {
      const r = this._keyToItem.get(e3);
      return t(r, { signal: s2 });
    }, peeker: "scale-first" === s ? (e3) => this._peekByScaleFirst(e3) : (e3) => this._peekByCenterFirst(e3) });
  }
  destroy() {
    this.clear(), this._queue = u(this._queue);
  }
  get length() {
    return this._queue ? this._queue.length : 0;
  }
  get onGoingCount() {
    return this._keyToItem.size;
  }
  abort(e2) {
    const t = "string" == typeof e2 ? e2 : e2.id;
    this._queue.abort(t);
  }
  clear() {
    this._queue.clear(), this._keyToItem.clear();
  }
  has(e2) {
    return "string" == typeof e2 ? this._keyToItem.has(e2) : this._keyToItem.has(e2.id);
  }
  isOngoing(e2) {
    const t = "string" == typeof e2 ? e2 : e2.id;
    return this.has(t) && this._queue.isOngoing(t);
  }
  pause() {
    this._queue.pause();
  }
  push(e2) {
    const t = e2.key.id;
    if (this._queue.has(t))
      return this._queue.get(t);
    const s = this._queue.push(t), r = () => {
      this._keyToItem.delete(t);
    };
    return this._keyToItem.set(t, e2), s.then(r, r), s;
  }
  reset() {
    this._queue.reset();
  }
  resume() {
    this._queue.resume();
  }
  _peekByScaleFirst(e2) {
    if (!this.state)
      return e2.values().next().value;
    const t = this.tileInfoView;
    let s = Number.NEGATIVE_INFINITY, r = Number.POSITIVE_INFINITY;
    e2.forEach((e3) => {
      const t2 = this._keyToItem.get(e3), o2 = this.tileInfoView.getTileScale(t2.key);
      h.has(o2) || (h.set(o2, []), s = Math.max(o2, s), r = Math.min(o2, r)), h.get(o2).push(t2.key), u2.add(o2);
    });
    let o = this.state.scale;
    h.has(o) || (c2(a, u2), a.sort((e3, t2) => e3 - t2), o = a.reduce((e3, t2) => Math.abs(t2 - o) < Math.abs(e3 - o) ? t2 : e3, a[0])), o = Math.min(o, s), o = Math.max(o, r);
    const i = h.get(o), n = t.getClosestInfoForScale(o), l2 = n.getColumnForX(this.state.center[0]), p2 = n.getRowForY(this.state.center[1]);
    return i.sort((e3, t2) => {
      const s2 = n.denormalizeCol(e3.col, e3.world), r2 = n.denormalizeCol(t2.col, t2.world);
      return Math.sqrt((l2 - s2) * (l2 - s2) + (p2 - e3.row) * (p2 - e3.row)) - Math.sqrt((l2 - r2) * (l2 - r2) + (p2 - t2.row) * (p2 - t2.row));
    }), u2.clear(), h.clear(), i[0].id;
  }
  _peekByCenterFirst(e2) {
    if (!this.state)
      return e2.values().next().value;
    const t = this.tileInfoView, s = this.state.center;
    let r, o = Number.POSITIVE_INFINITY;
    return e2.forEach((e3) => {
      const n = this._keyToItem.get(e3);
      t.getTileCoords(l, n.key);
      const c3 = m(l, s);
      c3 < o && (o = c3, r = n.key);
    }), r.id;
  }
};
e([y({ constructOnly: true })], p.prototype, "concurrency", void 0), e([y({ constructOnly: true })], p.prototype, "process", void 0), e([y()], p.prototype, "state", void 0), e([y({ constructOnly: true })], p.prototype, "strategy", void 0), e([y({ constructOnly: true })], p.prototype, "tileInfoView", void 0), p = e([c("esri.views.2d.tiling.TileQueue")], p);
var y2 = p;

export {
  y2 as y
};
//# sourceMappingURL=chunk-HHX6IUJQ.js.map
