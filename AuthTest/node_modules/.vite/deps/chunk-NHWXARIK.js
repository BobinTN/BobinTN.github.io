import {
  a
} from "./chunk-WDO2BXGR.js";
import {
  V
} from "./chunk-JUZJCTW2.js";
import {
  s as s2
} from "./chunk-OMPEZIP5.js";
import {
  i,
  y2 as y
} from "./chunk-LXXF7K7W.js";
import {
  c
} from "./chunk-SBW6NNVI.js";
import {
  e
} from "./chunk-62CXLI6S.js";
import {
  d,
  k
} from "./chunk-RFPH3ZTZ.js";
import {
  s2 as s
} from "./chunk-WJ3HJKNC.js";

// node_modules/@arcgis/core/layers/mixins/refresh.js
var t = new V();
var o = /* @__PURE__ */ new WeakMap();
function n(e2) {
  f(e2) && t.push(new WeakRef(e2));
}
function s3(e2) {
  const r = t.find((r2) => r2.deref() === e2);
  r && t.remove(r);
}
function f(e2) {
  return null != e2 && "object" == typeof e2 && "refreshInterval" in e2 && "refresh" in e2;
}
function c2(e2, r) {
  return Number.isFinite(e2) && Number.isFinite(r) ? r <= 0 ? e2 : c2(r, e2 % r) : 0;
}
var i2 = 0;
var l = 0;
function a2() {
  const e2 = Date.now();
  let r = false;
  for (const n2 of t) {
    const t2 = n2.deref();
    if (t2) {
      if (t2.refreshInterval) {
        e2 - (o.get(t2) ?? 0) + 5 >= 6e4 * t2.refreshInterval && (o.set(t2, e2), t2.refresh(e2));
      }
    } else
      r = true;
  }
  if (r)
    for (let o2 = t.length - 1; o2 >= 0; o2--) {
      t.at(o2).deref() || t.removeAt(o2);
    }
}
i(() => {
  const e2 = Date.now();
  let r = 0;
  for (const n2 of t) {
    const t2 = n2.deref();
    t2 && (r = c2(Math.round(6e4 * t2.refreshInterval), r), t2.refreshInterval ? o.get(t2) || o.set(t2, e2) : o.delete(t2));
  }
  if (r !== l) {
    if (l = r, clearInterval(i2), 0 === l)
      return void (i2 = 0);
    i2 = setInterval(a2, l);
  }
});

// node_modules/@arcgis/core/layers/mixins/RefreshableLayer.js
var m = 0.1;
var f2 = (c3) => {
  let f3 = class extends c3 {
    constructor(...e2) {
      super(...e2), this.refreshInterval = 0, this.refreshTimestamp = 0, this._debounceHasDataChanged = k(() => this.hasDataChanged()), this.when().then(() => {
        this.destroyed || n(this);
      }, () => {
      });
    }
    destroy() {
      s3(this);
    }
    castRefreshInterval(e2) {
      return e2 >= m ? e2 : e2 <= 0 ? 0 : m;
    }
    get refreshParameters() {
      return { _ts: this.refreshTimestamp || null };
    }
    refresh(e2 = Date.now()) {
      d(this._debounceHasDataChanged()).then((r) => {
        r && this._set("refreshTimestamp", e2), this.emit("refresh", { dataChanged: r });
      }, (e3) => {
        s.getLogger(this).error(e3), this.emit("refresh", { dataChanged: false, error: e3 });
      });
    }
    async hasDataChanged() {
      return true;
    }
    get test() {
      const e2 = this;
      return { set refreshInterval(r) {
        e2._set("refreshInterval", r);
      } };
    }
  };
  return e([y({ type: Number, json: { write: true, origins: { "web-scene": { write: { enabled: true, layerContainerTypes: a } } } } })], f3.prototype, "refreshInterval", void 0), e([s2("refreshInterval")], f3.prototype, "castRefreshInterval", null), e([y({ readOnly: true })], f3.prototype, "refreshTimestamp", void 0), e([y({ readOnly: true })], f3.prototype, "refreshParameters", null), f3 = e([c("esri.layers.mixins.RefreshableLayer")], f3), f3;
};

export {
  f2 as f
};
//# sourceMappingURL=chunk-NHWXARIK.js.map
