{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/support/associatedFeatureServiceUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{id as r}from\"../../kernel.js\";import e from\"../../request.js\";import n from\"../../core/Error.js\";import{throwIfAbortError as t}from\"../../core/promiseUtils.js\";import{parse as o}from\"./arcgisLayerUrl.js\";import a from\"../../portal/Portal.js\";import i from\"../../portal/PortalItem.js\";async function l(r,e){const t=o(r);if(!t)throw new n(\"invalid-url\",\"Invalid scene service url\");const a={...e,sceneServerUrl:t.url.path,layerId:t.sublayer??void 0};if(a.sceneLayerItem??=await s(a),null==a.sceneLayerItem)return f(a.sceneServerUrl.replace(\"/SceneServer\",\"/FeatureServer\"),a);const i=await y(a);if(!i?.url)throw new n(\"related-service-not-found\",\"Could not find feature service through portal item relationship\");const l=await f(i.url,a);return l.portalItem=i,l}async function s(r){const e=(await c(r)).serviceItemId;if(!e)return null;const n=new i({id:e,apiKey:r.apiKey}),o=await u(r);null!=o&&(n.portal=new a({url:o}));try{return n.load({signal:r.signal})}catch(l){return t(l),null}}async function c(r){if(r.rootDocument)return r.rootDocument;const n={query:{f:\"json\",token:r.apiKey},responseType:\"json\",signal:r.signal};try{const t=await e(r.sceneServerUrl,n);r.rootDocument=t.data}catch{r.rootDocument={}}return r.rootDocument}async function u(n){const o=r?.findServerInfo(n.sceneServerUrl);if(o?.owningSystemUrl)return o.owningSystemUrl;const a=n.sceneServerUrl.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";try{const r=(await e(a,{query:{f:\"json\"},responseType:\"json\",signal:n.signal})).data.owningSystemUrl;if(r)return r}catch(i){t(i)}return null}async function f(r,t){const a=o(r);if(!a)throw new n(\"invalid-feature-service-url\",\"Invalid feature service url\");const i=a.url.path,l=t.layerId;if(null==l)return{serverUrl:i};const s=c(t),u=r=>{const n={query:{f:\"json\"},responseType:\"json\",authMode:r,signal:t.signal};return e(i,n)},f=u(\"anonymous\").catch((()=>u(\"no-prompt\"))),[y,m]=await Promise.all([f,s]),p=m?.layers,d=y.data&&y.data.layers;if(!Array.isArray(d))throw new Error(\"expected layers array\");if(Array.isArray(p))for(let e=0;e<Math.min(p.length,d.length);e++){if(p[e].id===l)return{serverUrl:i,layerId:d[e].id}}else if(null!=l&&l<d.length)return{serverUrl:i,layerId:d[l].id};throw new Error(\"could not find matching associated sublayer\")}async function y({sceneLayerItem:r,signal:e}){if(!r)return null;try{const n=(await r.fetchRelatedItems({relationshipType:\"Service2Service\",direction:\"reverse\"},{signal:e})).find((r=>\"Feature Service\"===r.type))||null;if(!n)return null;const t=new i({portal:n.portal,id:n.id});return await t.load(),t}catch(n){return t(n),null}}export{l as findAssociatedFeatureService};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AAImS,eAAe,EAAE,GAAE,GAAE;AAAC,QAAMA,KAAE,EAAE,CAAC;AAAE,MAAG,CAACA;AAAE,UAAM,IAAI,EAAE,eAAc,2BAA2B;AAAE,QAAMC,KAAE,EAAC,GAAG,GAAE,gBAAeD,GAAE,IAAI,MAAK,SAAQA,GAAE,YAAU,OAAM;AAAE,MAAGC,GAAE,mBAAFA,GAAE,iBAAiB,MAAMC,GAAED,EAAC,IAAE,QAAMA,GAAE;AAAe,WAAO,EAAEA,GAAE,eAAe,QAAQ,gBAAe,gBAAgB,GAAEA,EAAC;AAAE,QAAM,IAAE,MAAM,EAAEA,EAAC;AAAE,MAAG,EAAC,uBAAG;AAAI,UAAM,IAAI,EAAE,6BAA4B,iEAAiE;AAAE,QAAME,KAAE,MAAM,EAAE,EAAE,KAAIF,EAAC;AAAE,SAAOE,GAAE,aAAW,GAAEA;AAAC;AAAC,eAAeD,GAAE,GAAE;AAAC,QAAM,KAAG,MAAM,EAAE,CAAC,GAAG;AAAc,MAAG,CAAC;AAAE,WAAO;AAAK,QAAM,IAAE,IAAI,EAAE,EAAC,IAAG,GAAE,QAAO,EAAE,OAAM,CAAC,GAAE,IAAE,MAAM,EAAE,CAAC;AAAE,UAAM,MAAI,EAAE,SAAO,IAAIE,GAAE,EAAC,KAAI,EAAC,CAAC;AAAG,MAAG;AAAC,WAAO,EAAE,KAAK,EAAC,QAAO,EAAE,OAAM,CAAC;AAAA,EAAC,SAAOD,IAAE;AAAC,WAAO,EAAEA,EAAC,GAAE;AAAA,EAAI;AAAC;AAAC,eAAe,EAAE,GAAE;AAAC,MAAG,EAAE;AAAa,WAAO,EAAE;AAAa,QAAM,IAAE,EAAC,OAAM,EAAC,GAAE,QAAO,OAAM,EAAE,OAAM,GAAE,cAAa,QAAO,QAAO,EAAE,OAAM;AAAE,MAAG;AAAC,UAAMH,KAAE,MAAM,EAAE,EAAE,gBAAe,CAAC;AAAE,MAAE,eAAaA,GAAE;AAAA,EAAI,QAAM;AAAC,MAAE,eAAa,CAAC;AAAA,EAAC;AAAC,SAAO,EAAE;AAAY;AAAC,eAAe,EAAE,GAAE;AAJvuC;AAIwuC,QAAM,KAAE,8BAAG,eAAe,EAAE;AAAgB,MAAG,uBAAG;AAAgB,WAAO,EAAE;AAAgB,QAAMC,KAAE,EAAE,eAAe,QAAQ,mBAAkB,IAAI,IAAE;AAAQ,MAAG;AAAC,UAAM,KAAG,MAAM,EAAEA,IAAE,EAAC,OAAM,EAAC,GAAE,OAAM,GAAE,cAAa,QAAO,QAAO,EAAE,OAAM,CAAC,GAAG,KAAK;AAAgB,QAAG;AAAE,aAAO;AAAA,EAAC,SAAO,GAAE;AAAC,MAAE,CAAC;AAAA,EAAC;AAAC,SAAO;AAAI;AAAC,eAAe,EAAE,GAAED,IAAE;AAAC,QAAMC,KAAE,EAAE,CAAC;AAAE,MAAG,CAACA;AAAE,UAAM,IAAI,EAAE,+BAA8B,6BAA6B;AAAE,QAAM,IAAEA,GAAE,IAAI,MAAKE,KAAEH,GAAE;AAAQ,MAAG,QAAMG;AAAE,WAAM,EAAC,WAAU,EAAC;AAAE,QAAMD,KAAE,EAAEF,EAAC,GAAEK,KAAE,CAAAC,OAAG;AAAC,UAAM,IAAE,EAAC,OAAM,EAAC,GAAE,OAAM,GAAE,cAAa,QAAO,UAASA,IAAE,QAAON,GAAE,OAAM;AAAE,WAAO,EAAE,GAAE,CAAC;AAAA,EAAC,GAAEO,KAAEF,GAAE,WAAW,EAAE,MAAO,MAAIA,GAAE,WAAW,CAAE,GAAE,CAACG,IAAE,CAAC,IAAE,MAAM,QAAQ,IAAI,CAACD,IAAEL,EAAC,CAAC,GAAEO,KAAE,uBAAG,QAAO,IAAED,GAAE,QAAMA,GAAE,KAAK;AAAO,MAAG,CAAC,MAAM,QAAQ,CAAC;AAAE,UAAM,IAAI,MAAM,uBAAuB;AAAE,MAAG,MAAM,QAAQC,EAAC;AAAE,aAAQ,IAAE,GAAE,IAAE,KAAK,IAAIA,GAAE,QAAO,EAAE,MAAM,GAAE,KAAI;AAAC,UAAGA,GAAE,CAAC,EAAE,OAAKN;AAAE,eAAM,EAAC,WAAU,GAAE,SAAQ,EAAE,CAAC,EAAE,GAAE;AAAA,IAAC;AAAA,WAAS,QAAMA,MAAGA,KAAE,EAAE;AAAO,WAAM,EAAC,WAAU,GAAE,SAAQ,EAAEA,EAAC,EAAE,GAAE;AAAE,QAAM,IAAI,MAAM,6CAA6C;AAAC;AAAC,eAAe,EAAE,EAAC,gBAAe,GAAE,QAAO,EAAC,GAAE;AAAC,MAAG,CAAC;AAAE,WAAO;AAAK,MAAG;AAAC,UAAM,KAAG,MAAM,EAAE,kBAAkB,EAAC,kBAAiB,mBAAkB,WAAU,UAAS,GAAE,EAAC,QAAO,EAAC,CAAC,GAAG,KAAM,CAAAG,OAAG,sBAAoBA,GAAE,IAAK,KAAG;AAAK,QAAG,CAAC;AAAE,aAAO;AAAK,UAAMN,KAAE,IAAI,EAAE,EAAC,QAAO,EAAE,QAAO,IAAG,EAAE,GAAE,CAAC;AAAE,WAAO,MAAMA,GAAE,KAAK,GAAEA;AAAA,EAAC,SAAO,GAAE;AAAC,WAAO,EAAE,CAAC,GAAE;AAAA,EAAI;AAAC;",
  "names": ["t", "a", "s", "l", "j", "u", "r", "f", "y", "p"]
}
