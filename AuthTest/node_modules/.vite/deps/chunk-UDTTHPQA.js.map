{
  "version": 3,
  "sources": ["../../@arcgis/core/symbols/cim/Rasterizer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.28/esri/copyright.txt for details.\n*/\nimport{nextPowerOfTwo as e}from\"../../core/mathUtils.js\";import{slsDashToTemplateArray as t,CIMSymbolHelper as a}from\"./CIMSymbolHelper.js\";import{rasterizeSimpleFill as r,rasterizeDash as i}from\"./rasterizingUtils.js\";import n from\"./Rect.js\";import{getSDFInfo as s,buildSDF as o}from\"./SDFHelper.js\";import{resampleHermite as l}from\"./utils.js\";const m=512;class c{constructor(e){this._resourceManager=e,this._lazyRasterizationCanvas=null}dispose(){this._lazyRasterizationCanvas=null}get _rasterizationCanvas(){return null==this._lazyRasterizationCanvas&&(this._lazyRasterizationCanvas=document.createElement(\"canvas\"),this._lazyRasterizationCanvas.getContext(\"2d\",{willReadFrequently:!0})),this._lazyRasterizationCanvas}rasterizeJSONResource(l,m,c){if(\"simple-fill\"===l.type||\"esriSFS\"===l.type){const[t,a,i]=r(this._rasterizationCanvas,l.style,m);return{size:[a,i],image:new Uint32Array(t.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:e(Math.ceil(m))}}if(\"simple-line\"===l.type||\"esriSLS\"===l.type||\"line\"===l.type&&l.dashTemplate){let e,a;if(\"simple-line\"===l.type||\"esriSLS\"===l.type)switch(e=t(l.style,l.cap),l.cap){case\"butt\":a=\"Butt\";break;case\"square\":a=\"Square\";break;default:a=\"Round\"}else e=l.dashTemplate,a=l.cim.capStyle;const[r,n,s]=i(e,a);return{size:[n,s],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let f,h=null,p=null,u=1;if(\"simple-marker\"===l.type||\"esriSMS\"===l.type||\"line-marker\"===l.type?(f=a.fromSimpleMarker(l),p=s(f)):l.cim&&\"CIMHatchFill\"===l.cim.type?(f=a.fromCIMHatchFill(l.cim,m),h=new n(f.frame.xmin,-f.frame.ymax,f.frame.xmax-f.frame.xmin,f.frame.ymax-f.frame.ymin),u=m):l.cim.markerPlacement&&\"CIMMarkerPlacementInsidePolygon\"===l.cim.markerPlacement.type?(f=a.fromCIMInsidePolygon(l.cim),h=new n(f.frame.xmin,-f.frame.ymax,f.frame.xmax-f.frame.xmin,f.frame.ymax-f.frame.ymin)):(f=l.cim,l.avoidSDFRasterization||(p=s(f))),p&&!c){const[e,t,a]=o(p);return e?{size:[t,a],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:u}:null}const[y,z,d,C,g]=a.rasterize(this._rasterizationCanvas,f,h,this._resourceManager,!c);return y?{size:[z,d],image:new Uint32Array(y.buffer),sdf:!1,simplePattern:!1,anchorX:C,anchorY:g}:null}rasterizeImageResource(e,t,a,r){this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const i=this._rasterizationCanvas.getContext(\"2d\");a instanceof ImageData?i.putImageData(a,0,0):(a.setAttribute(\"width\",`${e}px`),a.setAttribute(\"height\",`${t}px`),i.drawImage(a,0,0,e,t));const n=i.getImageData(0,0,e,t),s=new Uint8Array(n.data);if(r)for(const l of r)if(l&&l.oldColor&&4===l.oldColor.length&&l.newColor&&4===l.newColor.length){const[e,t,a,r]=l.oldColor,[i,n,o,m]=l.newColor;if(e===i&&t===n&&a===o&&r===m)continue;for(let l=0;l<s.length;l+=4)e===s[l]&&t===s[l+1]&&a===s[l+2]&&r===s[l+3]&&(s[l]=i,s[l+1]=n,s[l+2]=o,s[l+3]=m)}let o;for(let l=0;l<s.length;l+=4)o=s[l+3]/255,s[l]=s[l]*o,s[l+1]=s[l+1]*o,s[l+2]=s[l+2]*o;let c=s,f=e,h=t;const p=m;if(f>=p||h>=p){const a=f/h;a>1?(f=p,h=Math.round(p/a)):(h=p,f=Math.round(p*a)),c=new Uint8Array(4*f*h);const r=new Uint8ClampedArray(c.buffer);l(s,e,t,r,f,h,!1)}return{size:[f,h],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}export{c as default};\n"],
  "mappings": "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",
  "names": ["c", "e", "l", "m", "t", "a", "r", "i", "n", "o"]
}
